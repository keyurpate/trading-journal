<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Trading Journal - Advanced</title>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Trading Journal</h1>
        
        <div class="import-section">
            <h2>Import Trades</h2>
            <input type="file" id="csvFileInput" accept=".csv">
            <button id="importCsvButton">Import CSV</button>
            <button id="exportCsvButton" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-left: 10px;">ğŸ’¾ Export Backup</button>
            <button id="importBackupButton" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); margin-left: 10px;">ğŸ“‚ Import Backup</button>
            <input type="file" id="backupFileInput" accept=".json" style="display: none;">
            <button id="clearDataButton" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); margin-left: 10px;">ğŸ—‘ï¸ Clear All Data</button>
            <br><br>
            <label for="accountFilter">Filter by Account:</label>
            <select id="accountFilter">
                <option value="all">All Accounts</option>
            </select>
            <label for="playbookFilter" style="margin-left: 20px;">Filter by Playbook:</label>
            <select id="playbookFilter">
                <option value="all">All Playbooks</option>
            </select>
        </div>

        <!-- API Key Section -->
        <div class="import-section" style="margin-top: 20px;">
            <h2>ğŸ”‘ Market Data API Settings</h2>
            <label for="apiKeyInput">Polygon.io API Key:</label>
            <input type="text" id="apiKeyInput" placeholder="Enter your API key here" style="width: 400px; margin-right: 10px;">
            <button id="saveApiKeyButton" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">Save API Key</button>
            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                Don't have an API key? <a href="https://polygon.io/" target="_blank" style="color: #667eea;">Get one free at Polygon.io</a>
            </p>
        </div>

        <!-- Playbook Manager Section -->
        <div class="import-section" style="margin-top: 20px;">
            <h2>ğŸ“š Playbook Manager</h2>
            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                <input type="text" id="newPlaybookInput" placeholder="Enter new playbook name (e.g. VWAP Bounce)" style="flex: 1; width: auto;">
                <button id="addPlaybookButton" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">â• Add Playbook</button>
            </div>
            <div id="playbooksList" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                <!-- Playbooks will appear here -->
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-section">
            <div class="calendar-header">
                <button id="prevMonth" class="calendar-nav">â†</button>
                <div style="text-align: center;">
                    <h2 id="calendarTitle">October 2025</h2>
                    <p id="monthlyPnL" style="font-size: 14px; color: #64748b; margin-top: 5px; font-weight: 600;">Monthly P&L: $0.00</p>
                </div>
                <button id="nextMonth" class="calendar-nav">â†’</button>
            </div>
            <div id="calendar"></div>
        </div>
        
        <div id="tradesContainer"></div>
    </div>

    <!-- Chart Modal -->
    <div id="chartModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="chartTitle">Trade Chart</h2>
            <div id="tradeChart"></div>
        </div>
    </div>

    <!-- Day Trades Modal -->
    <div id="dayTradesModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close-day">&times;</span>
            <h2 id="dayTradesTitle">Trades for Selected Day</h2>
            <div id="dayTradesContent"></div>
            <div style="margin-top: 20px; text-align: center; display: flex; gap: 15px; justify-content: center;">
                <button id="viewDayTradesBtn" class="view-day-btn">ğŸ“‹ View Trades Below</button>
                <button id="deleteDayTradesBtn" class="delete-day-btn">ğŸ—‘ï¸ Delete All Trades This Day</button>
            </div>
        </div>
    </div>

    <!-- Edit Trade Modal -->
    <div id="editTradeModal" class="modal">
        <div class="modal-content">
            <span class="close-edit">&times;</span>
            <h2>âœï¸ Edit Trade Details</h2>
            <div id="editTradeForm">
                <div class="form-group">
                    <label>Playbook/Setup:</label>
                    <select id="editPlaybook">
                        <option value="">Select Playbook</option>
                        <!-- Will be populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label>Entry Quality:</label>
                    <div class="rating-buttons">
                        <button class="rating-btn" data-rating="1" data-type="entry">1 â­</button>
                        <button class="rating-btn" data-rating="2" data-type="entry">2 â­</button>
                        <button class="rating-btn" data-rating="3" data-type="entry">3 â­</button>
                        <button class="rating-btn" data-rating="4" data-type="entry">4 â­</button>
                        <button class="rating-btn" data-rating="5" data-type="entry">5 â­</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Exit Quality:</label>
                    <div class="rating-buttons">
                        <button class="rating-btn" data-rating="1" data-type="exit">1 â­</button>
                        <button class="rating-btn" data-rating="2" data-type="exit">2 â­</button>
                        <button class="rating-btn" data-rating="3" data-type="exit">3 â­</button>
                        <button class="rating-btn" data-rating="4" data-type="exit">4 â­</button>
                        <button class="rating-btn" data-rating="5" data-type="exit">5 â­</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Discipline Rating:</label>
                    <div class="rating-buttons">
                        <button class="rating-btn" data-rating="1" data-type="discipline">1 â­</button>
                        <button class="rating-btn" data-rating="2" data-type="discipline">2 â­</button>
                        <button class="rating-btn" data-rating="3" data-type="discipline">3 â­</button>
                        <button class="rating-btn" data-rating="4" data-type="discipline">4 â­</button>
                        <button class="rating-btn" data-rating="5" data-type="discipline">5 â­</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Tags (comma separated):</label>
                    <input type="text" id="editTags" placeholder="e.g. FOMO, Revenge Trade, Perfect Setup">
                </div>

                <div class="form-group">
                    <label>Mistakes Made:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="mistake-check" value="Overleveraged"> Overleveraged</label>
                        <label><input type="checkbox" class="mistake-check" value="Moved Stop"> Moved Stop Loss</label>
                        <label><input type="checkbox" class="mistake-check" value="FOMO"> FOMO Trade</label>
                        <label><input type="checkbox" class="mistake-check" value="Revenge"> Revenge Trading</label>
                        <label><input type="checkbox" class="mistake-check" value="No Plan"> No Trade Plan</label>
                        <label><input type="checkbox" class="mistake-check" value="Ignored Rules"> Ignored Rules</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Trade Notes/Journal:</label>
                    <textarea id="editNotes" rows="4" placeholder="What happened during this trade? What did you learn?"></textarea>
                </div>

                <div class="form-group">
                    <label>ğŸ“¸ Upload TradingView Screenshot:</label>
                    <input type="file" id="editScreenshotFile" accept="image/*" style="margin-bottom: 10px;">
                    <input type="text" id="editScreenshot" placeholder="Or paste image URL (e.g. https://i.imgur.com/example.png)">
                    <p style="font-size: 12px; color: #64748b; margin-top: 5px;">
                        ğŸ’¡ Upload your TradingView screenshot or paste Imgur URL
                    </p>
                    <div id="screenshotPreview" style="margin-top: 10px;"></div>
                </div>

                <button id="saveTradeBtn" class="save-trade-btn">ğŸ’¾ Save Trade</button>
            </div>
        </div>
    </div>

    <!-- Lightweight Charts Library -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script src="app.js"></script>
</body>
</html>
